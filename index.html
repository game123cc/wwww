<!DOCTYPE html>

<html lang="ru">

<head>

<meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>Набросок коллекций</title>

<style>

:root { --accent: rgba(255,255,255,0.12); }

body {

  margin: 0;

  padding: 0;

  background: #1e1e1f;

  font-family: Arial, sans-serif;

  color: white;

  overflow-x: hidden;

  user-select: none;

  -webkit-user-select: none;

  -moz-user-select: none;

  -ms-user-select: none;

  -webkit-touch-callout: none;

}

* {

  user-select: none;

  -webkit-user-select: none;

  -moz-user-select: none;

  -ms-user-select: none;

  -webkit-touch-callout: none;

}

input, textarea {

  user-select: text;

  -webkit-user-select: text;

  -moz-user-select: text;

  -ms-user-select: text;

}

img {

  -webkit-user-drag: none;

  -khtml-user-drag: none;

  -moz-user-drag: none;

  -o-user-drag: none;

  user-drag: none;

  pointer-events: none;

}

video {

  -webkit-user-drag: none;

  -khtml-user-drag: none;

  -moz-user-drag: none;

  -o-user-drag: none;

  user-drag: none;

}



/* ===== ВЕРХНЯЯ ПАНЕЛЬ ===== */

.top-bar {

  position: absolute;

  top: 12px;

  left: 50%;

  transform: translateX(-50%);

  width: 90%;

  max-width: 1300px;

  height: 70px;

  background: var(--accent);

  display: flex;

  align-items: center;

  justify-content: space-between;

  padding-left: 24px;

  padding-right: 24px;

  box-shadow: 0 2px 15px rgba(0, 0, 0, 0.3);

  z-index: 200;

  backdrop-filter: blur(10px);

  border-radius: 12px;

}

.register-icon, .avatar-icon, .search-icon {

  width: 60px;

  height: 60px;

  border-radius: 50%;

  cursor: pointer;

  transition: transform 0.25s ease, filter 0.3s ease;

  filter: drop-shadow(0 0 8px rgba(0, 0, 0, 0.5));

  background-size: cover;

  background-position: center;

  flex: 0 0 auto;

}

.register-icon { background-image: url('icons/register.png'); margin-left: 10px; }

.avatar-icon { display: none; margin-left: 10px; }

.search-icon { background-image: url('icons/search.png'); margin-right: 10px; }

.register-icon:hover, .avatar-icon:hover, .search-icon:hover {

  transform: scale(1.05);

  filter: drop-shadow(0 0 12px rgba(255, 200, 50, 0.8));

}



/* ===== ПОЛЕ ПОИСКА ===== */

.search-input {

  position: absolute;

  left: 50%;

  transform: translateX(-50%);

  width: 300px;

  max-width: 40%;

  height: 45px;

  padding: 0 15px;

  border-radius: 25px;

  border: none;

  background: rgba(255, 255, 255, 0.1);

  color: white;

  font-size: 16px;

  outline: none;

  display: none;

  z-index: 201;

  backdrop-filter: blur(10px);

  transition: all 0.3s ease;

}

.search-input.visible {

  display: block;

  animation: slideIn 0.3s ease;

}

@keyframes slideIn {

  from {

    opacity: 0;

    transform: translateX(-50%) translateY(-10px);

  }

  to {

    opacity: 1;

    transform: translateX(-50%) translateY(0);

  }

}

.search-input::placeholder {

  color: rgba(255, 255, 255, 0.5);

}

.search-input:focus {

  background: rgba(255, 255, 255, 0.15);

  box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);

}



/* ====== МОДАЛКА ====== */

.auth-modal {

  position: fixed;

  left: 50%;

  top: 50%;

  transform: translate(-50%,-50%);

  width: 360px;

  background: rgba(10,10,10,0.9);

  border-radius: 14px;

  padding: 18px;

  box-shadow: 0 10px 40px rgba(0,0,0,0.6);

  z-index: 500;

  display: none;

  color: #fff;

}

.auth-modal.visible { display: block; }

.auth-tabs { display: flex; gap: 8px; margin-bottom: 12px; }

.auth-tab { flex: 1; padding: 10px; text-align: center; cursor: pointer; border-radius: 10px; background: rgba(255,255,255,0.04); }

.auth-tab.active { background: rgba(255,255,255,0.12); font-weight: 700; }

.auth-form { margin-top: 6px; }

.input-group { position: relative; margin-bottom: 12px; }

.auth-form input {

  width: 100%;

  padding: 10px 40px 10px 12px;

  border-radius: 8px;

  border: none;

  background: rgba(255,255,255,0.05);

  color: #fff;

  outline: none;

}

.eye-icon {

  position: absolute;

  right: 10px;

  top: 50%;

  transform: translateY(-50%);

  width: 24px;

  height: 24px;

  background-size: cover;

  background-position: center;

  cursor: pointer;

  opacity: 0.7;

  transition: opacity .2s ease;

}

.eye-icon:hover { opacity: 1; }

.auth-form button {

  width: 100%;

  padding: 10px;

  border-radius: 8px;

  border: none;

  background: #fff;

  color: #000;

  cursor: pointer;

  font-weight: 700;

}

.auth-error { color: #ff8080; font-size: 13px; margin: 8px 0; display: none; text-align: center; }



/* ===== Профиль ===== */

.profile-panel {

  position: fixed;

  top: 86px;

  right: calc(5% + 12px);

  width: 260px;

  background: rgba(10,10,10,0.75);

  border-radius: 12px;

  padding: 18px;

  display: none;

  z-index: 300;

  box-shadow: 0 10px 30px rgba(0,0,0,0.6);

  backdrop-filter: blur(6px);

}

.profile-panel.visible { display: block; animation: pop .18s ease; }

@keyframes pop { from {opacity: 0; transform: translateY(-6px) scale(.995);} to {opacity: 1; transform: translateY(0) scale(1);} }

.profile-avatar { width: 72px; height: 72px; border-radius: 50%; margin: 0 auto 10px; background-size: cover; background-position: center; border: 2px solid rgba(255,255,255,0.06); }

.profile-name { text-align: center; font-weight: 600; margin-bottom: 8px; }

.profile-actions { text-align: center; margin-top: 6px; }

.profile-btn {

  border: none;

  background: rgba(255,255,255,0.08);

  color: white;

  padding: 8px 12px;

  border-radius: 10px;

  cursor: pointer;

  margin: 6px 4px;

}

.profile-btn:hover { background: rgba(255,255,255,0.16); }



/* ===== Видео ===== */

.video-frame{

  position:relative;

  width:90%;

  max-width:1300px;

  height:600px;

  background:#000;

  border-radius:20px;

  margin:20px auto 30px;

  overflow:hidden;

}

.video-frame video{

  width:100%;

  height:100%;

  object-fit:cover;

  border-radius:20px;

}

.sound-btn{

  position:absolute;

  bottom:15px;

  right:15px;

  width:55px;

  height:55px;

  background-color:rgba(255,255,255,0.6);

  background-image:url('icons/sound-off.png');

  background-size:70% 70%;

  background-repeat:no-repeat;

  background-position:center;

  border-radius:50%;

  cursor:pointer;

  z-index:120;

  transition:transform 0.2s ease, background-color 0.3s ease;

}

.sound-btn:hover{transform:scale(1.08);background-color:rgba(255,255,255,0.85);}



/* ===== ПАНЕЛИ ===== */

.top-panels{

  position:relative;

  width:100%;

  display:flex;

  justify-content:center;

  align-items:center;

  gap:40px;

  margin:60px auto 40px;

  perspective:1000px;

}

.panel{

  position:relative;

  width:140px;

  height:240px;

  background-size:cover;

  background-position:center;

  border-radius:10px;

  transition:all 0.5s ease;

  box-shadow:0 0 15px rgba(0,0,0,0.6);

  filter:brightness(0.6);

  transform:scale(0.9) rotateY(-20deg);

  opacity:0.7;

  overflow:hidden;

}

.panel.active{

  width:180px;

  height:320px;

  transform:scale(1.1) rotateY(0deg);

  filter:brightness(1.2);

  opacity:1;

  box-shadow:0 0 25px rgba(255,140,0,0.8);

}



/* ===== Названия ===== */

.panel-title {

  position: absolute;

  bottom: 0;

  width: 100%;

  text-align: center;

  font-size: 30px;

  font-weight: 900;

  text-transform: uppercase;

  letter-spacing: 2px;

  padding: 12px 0;

  background: rgba(0,0,0,0.5);

  color: #ff7ffb;

  text-shadow: 0 0 5px #ff00ff, 0 0 10px #ff00ff, 0 0 20px #ff00ff, 0 0 40px #ff00ff;

  opacity: 0;

  transition: opacity 0.4s ease;

}

.panel.active .panel-title { opacity: 1; }



.controls{text-align:center;margin-top:-20px;}

.arrow{display:inline-block;font-size:34px;color:#fff;cursor:pointer;user-select:none;background:none;padding:20px 70px;margin:0 15px;border-radius:40px;transition:0.3s ease;border:none;}

.arrow:hover{background:rgba(255,255,255,0.1);transform:scale(1.15);}

.counter{display:inline-block;font-size:20px;color:#fff;margin:0 20px;user-select:none;}

@media(max-width:600px){

  .video-frame{height:360px;width:100%;border-radius:0;}

  .panel{width:100px;height:160px;}

  .panel.active{width:130px;height:220px;}

  .arrow{padding:14px 40px;font-size:28px;}

  .panel-title {font-size:18px;}

}

</style>

</head>

<body>



<!-- ===== ВЕРХ ===== -->

<div class="top-bar">

  <div class="search-icon" id="searchBtn"></div>

  <input type="text" class="search-input" id="searchInput" placeholder="Поиск...">

  <div class="register-icon" id="registerBtn"></div>

  <div class="avatar-icon" id="avatarBtn" style="background-image:url('img/default-avatar.png');"></div>

</div>



<!-- ===== МОДАЛКА ===== -->

<div class="auth-modal" id="authModal">

  <div class="auth-tabs">

    <div class="auth-tab active" id="tabLogin">Вход</div>

    <div class="auth-tab" id="tabRegister">Регистрация</div>

  </div>

  <form id="loginForm" class="auth-form">

    <div class="input-group"><input type="text" id="login_username" placeholder="Никнейм" required></div>

    <div class="input-group"><input type="password" id="login_password" placeholder="Пароль" required><div class="eye-icon" id="login_eye" style="background-image:url('icons/eye-closed.png');"></div></div>

    <div class="auth-error" id="loginError"></div><button type="submit">Войти</button>

  </form>

  <form id="registerForm" class="auth-form" style="display:none;">

    <div class="input-group"><input type="text" id="reg_username" placeholder="Никнейм" minlength="3" required></div>

    <div class="input-group"><input type="password" id="reg_password" placeholder="Пароль" minlength="6" required><div class="eye-icon" id="reg_eye1" style="background-image:url('icons/eye-closed.png');"></div></div>

    <div class="input-group"><input type="password" id="reg_repeat" placeholder="Повторите пароль" minlength="6" required><div class="eye-icon" id="reg_eye2" style="background-image:url('icons/eye-closed.png');"></div></div>

    <div class="auth-error" id="regError"></div><button type="submit">Зарегистрироваться</button>

  </form>

</div>



<!-- ===== ПРОФИЛЬ ===== -->

<div class="profile-panel" id="profilePanel">

  <div class="profile-avatar" id="profileAvatar" style="background-image:url('img/default-avatar.png');"></div>

  <div class="profile-name" id="profileName">Гость</div>

  <div class="profile-actions"><button class="profile-btn" id="logoutBtn">Выйти</button></div>

</div>



<!-- ===== ВИДЕО ===== -->

<div class="video-frame">

  <video id="mainVideo" autoplay loop muted playsinline>

    <source src="video/main.mp4" type="video/mp4">

  </video>

  <div class="sound-btn" id="soundBtn"></div>

</div>



<!-- ===== ПАНЕЛИ ===== -->

<div class="top-panels" id="topPanels"></div>



<div class="controls">

  <span class="arrow left" id="prevBtn">◄</span>

  <span class="counter" id="counter">1/20</span>

  <span class="arrow right" id="nextBtn">►</span>

</div>



<script>

// ===== звук =====

const video=document.getElementById('mainVideo');

const soundBtn=document.getElementById('soundBtn');

soundBtn.addEventListener('click',()=>{video.muted=!video.muted;soundBtn.style.backgroundImage=video.muted?"url('icons/sound-off.png')":"url('icons/sound-on.png')";});



// ===== панели =====

const titles=["СОПРАНО","ГОЛЯК","ИГРА ПРЕСТОЛОВ","МОЛОКОСОСЫ","БЕССТЫЖИЕ","ЗАДОРНЫЕ РЕБЯТА","ВРЕМЯ ПРИКЛЮЧЕНИЙ","БИВИС И БАТХЕД","ДАРЬЯ","ДОМ ДРАКОНА","ОДНАЖДЫ В ГОЛЛИВУДЕ","МАЛЬШНИК В ЛАС ВЕГАСЕ","АМЕРИКАНСКАЯ ИСТОРИЯ УЖАСОВ","ХОДЯЧИЕ МЕРТВЕЦЫ","ДЕКСТЕР","ОХОТА","АМЕЛИ","ВОЛК С УОЛ СТРИТ","ОСТАРЫЕ КОЗЫРЬКИ","ГНЕВ"];

const topPanels=document.getElementById('topPanels');



// цветная подсветка для всех названий

const colorMap = {

  "СОПРАНО": "#FF4DFF",                    // фиолетово-розовый

  "ГОЛЯК": "#00E5FF",                      // циановый

  "ИГРА ПРЕСТОЛОВ": "#FFD166",            // золотой

  "МОЛОКОСОСЫ": "#7CFFB2",                // мятный

  "БЕССТЫЖИЕ": "#FF6B6B",                 // красно-оранжевый

  "ЗАДОРНЫЕ РЕБЯТА": "#FF9F43",           // оранжевый

  "ВРЕМЯ ПРИКЛЮЧЕНИЙ": "#00D2FF",         // голубой

  "БИВИС И БАТХЕД": "#FF00FF",            // ярко-розовый

  "ДАРЬЯ": "#9B59B6",                     // фиолетовый

  "ДОМ ДРАКОНА": "#E74C3C",                // красный

  "ОДНАЖДЫ В ГОЛЛИВУДЕ": "#F39C12",       // янтарный

  "МАЛЬШНИК В ЛАС ВЕГАСЕ": "#1ABC9C",     // бирюзовый

  "АМЕРИКАНСКАЯ ИСТОРИЯ УЖАСОВ": "#8E44AD",// темно-фиолетовый

  "ХОДЯЧИЕ МЕРТВЕЦЫ": "#27AE60",          // зеленый

  "ДЕКСТЕР": "#C0392B",                    // темно-красный

  "ОХОТА": "#16A085",                     // изумрудный

  "АМЕЛИ": "#E67E22",                      // морковный

  "ВОЛК С УОЛ СТРИТ": "#3498DB",          // синий

  "ОСТАРЫЕ КОЗЫРЬКИ": "#2ECC71",           // изумрудно-зеленый

  "ГНЕВ": "#E91E63"                        // розово-красный

};



for(let i=1;i<=20;i++){

  const p=document.createElement('div');

  p.className='panel';

  p.style.backgroundImage=`url('img/top/${i}.png')`;



  // добавляем заголовок и сохраняем имя и цвет в data-атрибуты для всех плашек

  const t=document.createElement('div');

  t.className='panel-title';

  t.textContent=titles[i-1];

  p.appendChild(t);

  p.dataset.title = titles[i-1];

  p.dataset.color = colorMap[titles[i-1]] || '#ffffff';



  topPanels.appendChild(p);

}



// Видимое количество плашек: на телефоне 3, на десктопе 5.

// Функция проверяет ширину окна и возвращает соответствующее значение.

function getVisibleCount(){

  return window.innerWidth <= 600 ? 3 : 5;

}



// получить актуальный список панелей (NodeList -> Array удобнее)

let panels = Array.from(document.querySelectorAll('.panel'));

// Устанавливаем currentIndex так, чтобы первая плашка (индекс 0) была активна по центру

let visibleCount = getVisibleCount();

let centerOffset = Math.floor(visibleCount/2);

let currentIndex = (0 - centerOffset + panels.length) % panels.length;



// начальное значение visibleCount (уже установлено выше)



// helper: сбросить inline-подсветку

function clearPanelStyle(p){

  p.style.boxShadow = '';

  // вернуть стандартный text-shadow цвет у заголовка (если есть)

  const titleEl = p.querySelector('.panel-title');

  if(titleEl){

    titleEl.style.color = '';

    titleEl.style.textShadow = '';

  }

}



// функция обновления счетчика

function updateCounter(){

  const vCount = getVisibleCount();

  const centerOffset = Math.floor(vCount/2);

  const centerIndex = (currentIndex + centerOffset + panels.length) % panels.length;

  const counter = document.getElementById('counter');

  counter.textContent = `${centerIndex + 1}/${panels.length}`;

}



// основная функция отображения

function updatePanels(){

  // обновляем видимое количество (учитываем возможное изменение размера экрана)

  visibleCount = getVisibleCount();



  // прячем все

  panels.forEach(p=>{ p.style.display='none'; clearPanelStyle(p); p.classList.remove('active'); });



  // центральный индекс (тот, который должен быть активен и в центре)

  const centerOffset = Math.floor(visibleCount/2); // 2 для visibleCount=5, 1 для visibleCount=3

  const centerIndex = (currentIndex + centerOffset + panels.length) % panels.length;



  // показываем visibleCount панелей, учитывая границы массива

  // вычисляем начальный индекс для отображения

  // Вычисляем startIdx на основе centerIndex

  let startIdx = centerIndex - centerOffset;

  // Если startIdx отрицательный (при первых плашках), начинаем с 0

  if(startIdx < 0){

    startIdx = 0;

  }

  // Вычисляем сколько плашек нужно показать

  let panelsToShow = visibleCount;

  // При первых плашках показываем меньше плашек (3 плашки: 0, 1, 2)

  if(centerIndex < centerOffset){

    // Показываем только столько плашек, чтобы активная была в центре показанных

    panelsToShow = centerIndex + centerOffset + 1;

    if(panelsToShow > visibleCount) panelsToShow = visibleCount;

    startIdx = 0;

  }

  

  // Показываем плашки без циклического перехода

  // При листании вправо плашки сдвигаются влево, новые появляются справа

  // Когда доходим до определенного момента, плашки пропадают слева

  for(let i=0;i<panelsToShow;i++){

    // Вычисляем индекс

    let idx = startIdx + i;

    // Показываем плашку только если индекс в допустимом диапазоне

    if(idx >= 0 && idx < panels.length){

      panels[idx].style.display = 'block';

    }

    // Если индекс выходит за границы массива, не показываем плашку

  }



  // помечаем активный и применяем цветовую подсветку если есть

  panels.forEach((p, i)=>{

    if(i === centerIndex){

      p.classList.add('active');

      // если у панели есть назначенный цвет — применяем внешнюю подсветку

      const col = p.dataset.color;

      if(col){

        // сильная разноцветная тень для активной плашки

        p.style.boxShadow = `0 0 30px ${col}, 0 0 60px ${col}33`;

        const titleEl = p.querySelector('.panel-title');

        if(titleEl){

          titleEl.style.color = col;

          titleEl.style.textShadow = `0 0 8px ${col}, 0 0 18px ${col}`;

        }

      } else {

        // если цвет не задан — применяем дефолтный активный эффект (без изменения цвета)

        p.style.boxShadow = '0 0 25px rgba(255,140,0,0.8)';

      }

    } else {

      // неактивные — оставить базовую тень

      // (clearPanelStyle уже убрал инлайновые стили)

    }

  });



  // Нормализуем currentIndex, чтобы он был в диапазоне [0, panels.length-1]

  // Это важно для сохранения правильного состояния при следующих обновлениях

  currentIndex = ((currentIndex % panels.length) + panels.length) % panels.length;

  

  // обновляем счетчик

  updateCounter();

}



// функция для получения текущего центрального индекса

function getCenterIndex(){

  const centerOffset = Math.floor(getVisibleCount()/2);

  return (currentIndex + centerOffset + panels.length) % panels.length;

}



// стрелки

document.getElementById('prevBtn').onclick = ()=>{

  const centerIdx = getCenterIndex();

  // не двигаемся, если уже на первой плашке

  if(centerIdx === 0) return;

  // чтобы активная всегда была в центре, мы двигаем currentIndex на -1

  currentIndex = (currentIndex - 1 + panels.length) % panels.length;

  updatePanels();

};

document.getElementById('nextBtn').onclick = ()=>{

  const centerIdx = getCenterIndex();

  // не двигаемся, если уже на последней плашке

  if(centerIdx === panels.length - 1) return;

  currentIndex = (currentIndex + 1) % panels.length;

  updatePanels();

};



// также полезно: клик по панели — открыть плеер или центрировать

topPanels.addEventListener('click', (e) => {

  const clicked = e.target.closest('.panel');

  if(!clicked) return;

  const idx = panels.indexOf(clicked);

  if(idx === -1) return;

  // Открываем плеер для этой плашки с параметром индекса

  window.location.href = `players/player.html?index=${idx + 1}`;

});



updatePanels();



// реагируем на изменение размера — обновляем visibleCount и перестраиваем отображение

window.addEventListener('resize', ()=>{

  const oldVisible = visibleCount;

  const newVisible = getVisibleCount();

  if(oldVisible !== newVisible){

    // при смене количества видимых элементов корректируем currentIndex так, чтобы визуально не было "скачка"

    // (сохраняем центр на том же элементе, если можно)

    const centerOffsetOld = Math.floor(oldVisible / 2);

    const centerIndex = (currentIndex + centerOffsetOld + panels.length) % panels.length;

    const centerOffsetNew = Math.floor(newVisible / 2);

    currentIndex = (centerIndex - centerOffsetNew + panels.length) % panels.length;

  }

  updatePanels();

});



// ===== регистрация / вход =====

function toggleEye(inputId,iconId){

  const input=document.getElementById(inputId);

  const icon=document.getElementById(iconId);

  icon.addEventListener('click',()=>{

    if(input.type==='password'){input.type='text';icon.style.backgroundImage="url('icons/eye-open.png')";}

    else{input.type='password';icon.style.backgroundImage="url('icons/eye-closed.png')";}

  });

}

toggleEye('login_password','login_eye');

toggleEye('reg_password','reg_eye1');

toggleEye('reg_repeat','reg_eye2');



function loadUsers(){return JSON.parse(localStorage.getItem('users')||'[]');}

function saveUsers(u){localStorage.setItem('users',JSON.stringify(u));}

function setCurrentUser(u){localStorage.setItem('user',JSON.stringify(u));}

function getCurrentUser(){return JSON.parse(localStorage.getItem('user')||'null');}



const regForm=document.getElementById('registerForm');

const loginForm=document.getElementById('loginForm');

const regError=document.getElementById('regError');

const loginError=document.getElementById('loginError');

const avatarBtn=document.getElementById('avatarBtn');

const registerBtn=document.getElementById('registerBtn');

const authModal=document.getElementById('authModal');

const tabLogin=document.getElementById('tabLogin');

const tabRegister=document.getElementById('tabRegister');

const profilePanel=document.getElementById('profilePanel');

const profileAvatar=document.getElementById('profileAvatar');

const profileName=document.getElementById('profileName');

const logoutBtn=document.getElementById('logoutBtn');



function showModal(tab){

  authModal.classList.add('visible');

  if(tab==='register'){

    tabRegister.classList.add('active');tabLogin.classList.remove('active');

    loginForm.style.display='none';regForm.style.display='block';

  }else{

    tabLogin.classList.add('active');tabRegister.classList.remove('active');

    regForm.style.display='none';loginForm.style.display='block';

  }

}

tabLogin.onclick=()=>showModal('login');

tabRegister.onclick=()=>showModal('register');

registerBtn.onclick=()=>showModal('login');

document.addEventListener('click',e=>{

  if(authModal.classList.contains('visible')&&!authModal.contains(e.target)&&!registerBtn.contains(e.target)){

    authModal.classList.remove('visible');

  }

});



regForm.addEventListener('submit',e=>{

  e.preventDefault();

  const username=document.getElementById('reg_username').value.trim();

  const pass=document.getElementById('reg_password').value;

  const rep=document.getElementById('reg_repeat').value;

  if(username.length<3){regError.textContent='Ник минимум 3 символа';regError.style.display='block';return;}

  if(pass.length<6){regError.textContent='Пароль минимум 6 символов';regError.style.display='block';return;}

  if(pass!==rep){regError.textContent='Пароли не совпадают';regError.style.display='block';return;}

  const users=loadUsers();

  if(users.find(u=>u.name.toLowerCase()===username.toLowerCase())){

    regError.textContent='Ник уже занят';regError.style.display='block';return;

  }

  users.push({name:username,pass:pass,avatar:'img/default-avatar.png'});

  saveUsers(users);

  setCurrentUser({name:username,avatar:'img/default-avatar.png'});

  location.reload();

});



loginForm.addEventListener('submit',e=>{

  e.preventDefault();

  const username=document.getElementById('login_username').value.trim();

  const password=document.getElementById('login_password').value;

  const users=loadUsers();



  const user=users.find(u=>u.name.toLowerCase()===username.toLowerCase()&&u.pass===password);



  if(!user){

    loginError.textContent='Неверный логин или пароль';

    loginError.style.display='block';

    return;

  }

  setCurrentUser(user);

  location.reload();

});



// ===== загрузка пользователя =====

function updateUI(){

  const user=getCurrentUser();

  if(user){

    registerBtn.style.display='none';

    avatarBtn.style.display='block';

    avatarBtn.style.backgroundImage=`url('${user.avatar}')`;

    profileName.textContent=user.name;

    profileAvatar.style.backgroundImage=`url('${user.avatar}')`;

  }else{

    registerBtn.style.display='block';

    avatarBtn.style.display='none';

  }

}

updateUI();



// ===== панель профиля =====

avatarBtn.addEventListener('click',()=>{

  profilePanel.classList.toggle('visible');

});

logoutBtn.addEventListener('click',()=>{

  localStorage.removeItem('user');

  location.reload();

});



// ===== поиск =====

const searchBtn = document.getElementById('searchBtn');

const searchInput = document.getElementById('searchInput');



// Функция фильтрации плашек по названию

function filterPanels(searchText){

  const searchLower = searchText.toLowerCase().trim();

  

  if(searchLower === ''){

    // Если поле пустое - показываем все плашки и восстанавливаем нормальное отображение

    updatePanels();

    return;

  }

  

  // Скрываем все плашки

  panels.forEach(p=>{ 

    p.style.display='none'; 

    clearPanelStyle(p); 

    p.classList.remove('active'); 

  });

  

  // Находим плашки, которые соответствуют поисковому запросу

  const matchingPanels = [];

  panels.forEach((p, index)=>{

    const panelTitle = p.dataset.title || '';

    if(panelTitle.toLowerCase().includes(searchLower)){

      matchingPanels.push({panel: p, index: index});

    }

  });

  

  // Показываем только найденные плашки

  if(matchingPanels.length > 0){

    matchingPanels.forEach((item, i)=>{

      item.panel.style.display = 'block';

      // Делаем первую найденную плашку активной

      if(i === 0){

        item.panel.classList.add('active');

        const col = item.panel.dataset.color;

        if(col){

          item.panel.style.boxShadow = `0 0 30px ${col}, 0 0 60px ${col}33`;

          const titleEl = item.panel.querySelector('.panel-title');

          if(titleEl){

            titleEl.style.color = col;

            titleEl.style.textShadow = `0 0 8px ${col}, 0 0 18px ${col}`;

          }

        } else {

          item.panel.style.boxShadow = '0 0 25px rgba(255,140,0,0.8)';

        }

      }

    });

    

    // Обновляем счетчик

    const firstMatchIndex = matchingPanels[0].index;

    const counter = document.getElementById('counter');

    counter.textContent = `${firstMatchIndex + 1}/${panels.length}`;

  } else {

    // Если ничего не найдено - обновляем счетчик

    const counter = document.getElementById('counter');

    counter.textContent = `0/${panels.length}`;

  }

}



searchBtn.addEventListener('click', ()=>{

  searchInput.classList.toggle('visible');

  if(searchInput.classList.contains('visible')){

    setTimeout(()=>{

      searchInput.focus();

    }, 100);

  } else {

    searchInput.value = '';

    filterPanels(''); // Восстанавливаем все плашки

  }

});



// Обработчик ввода текста в поле поиска

searchInput.addEventListener('input', (e)=>{

  filterPanels(e.target.value);

});



// Закрытие поиска при клике вне поля

document.addEventListener('click', (e)=>{

  if(!searchInput.contains(e.target) && !searchBtn.contains(e.target)){

    searchInput.classList.remove('visible');

    searchInput.value = '';

    filterPanels(''); // Восстанавливаем все плашки

  }

});



// ===== блокировка копирования =====

// Блокировка контекстного меню

document.addEventListener('contextmenu', function(e) {

  e.preventDefault();

  return false;

});



// Блокировка горячих клавиш копирования

document.addEventListener('keydown', function(e) {

  // Ctrl+C, Ctrl+A, Ctrl+V, Ctrl+X, Ctrl+S, F12

  if((e.ctrlKey && (e.key === 'c' || e.key === 'C' || e.key === 'v' || e.key === 'V' || e.key === 'x' || e.key === 'X' || e.key === 'a' || e.key === 'A' || e.key === 's' || e.key === 'S')) || 

     e.key === 'F12' || 

     (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'i' || e.key === 'J' || e.key === 'j' || e.key === 'C' || e.key === 'c')) ||

     (e.ctrlKey && e.key === 'U' || e.ctrlKey && e.key === 'u')) {

    e.preventDefault();

    return false;

  }

});



// Блокировка выделения текста через мышь

document.addEventListener('selectstart', function(e) {

  e.preventDefault();

  return false;

});



// Блокировка перетаскивания изображений

document.addEventListener('dragstart', function(e) {

  e.preventDefault();

  return false;

});



// Блокировка копирования через буфер обмена

document.addEventListener('copy', function(e) {

  e.clipboardData.setData('text/plain', '');

  e.preventDefault();

  return false;

});

</script>

</body>

</html>
