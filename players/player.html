<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Плеер</title>
<style>
:root { --accent: rgba(255,255,255,0.12); }

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: #1e1e1f;
  font-family: Arial, sans-serif;
  color: white;
  overflow-x: hidden;
  user-select: none;
  padding: 10px;
  position: relative;
}

/* ===== Неоновые полоски ===== */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 0;
  background: 
    linear-gradient(90deg, transparent 0%, rgba(0, 255, 255, 0.1) 50%, transparent 100%) 10% 20% / 200px 3px,
    linear-gradient(90deg, transparent 0%, rgba(255, 0, 255, 0.1) 50%, transparent 100%) 30% 60% / 150px 2px,
    linear-gradient(0deg, transparent 0%, rgba(0, 255, 255, 0.08) 50%, transparent 100%) 70% 10% / 3px 180px,
    linear-gradient(90deg, transparent 0%, rgba(255, 100, 255, 0.12) 50%, transparent 100%) 85% 80% / 180px 2px,
    linear-gradient(0deg, transparent 0%, rgba(100, 255, 255, 0.1) 50%, transparent 100%) 20% 50% / 2px 200px,
    linear-gradient(90deg, transparent 0%, rgba(255, 50, 150, 0.1) 50%, transparent 100%) 50% 30% / 160px 2px,
    linear-gradient(0deg, transparent 0%, rgba(150, 100, 255, 0.08) 50%, transparent 100%) 90% 70% / 2px 150px;
  background-repeat: no-repeat;
  animation: neonMove 20s infinite linear;
}

@keyframes neonMove {
  0% { 
    background-position: 
      10% 20%, 
      30% 60%, 
      70% 10%, 
      85% 80%, 
      20% 50%, 
      50% 30%, 
      90% 70%;
  }
  25% { 
    background-position: 
      15% 25%, 
      35% 65%, 
      75% 15%, 
      80% 75%, 
      25% 55%, 
      55% 35%, 
      85% 75%;
  }
  50% { 
    background-position: 
      20% 30%, 
      40% 70%, 
      80% 20%, 
      75% 70%, 
      30% 60%, 
      60% 40%, 
      80% 80%;
  }
  75% { 
    background-position: 
      15% 25%, 
      35% 65%, 
      75% 15%, 
      80% 75%, 
      25% 55%, 
      55% 35%, 
      85% 75%;
  }
  100% { 
    background-position: 
      10% 20%, 
      30% 60%, 
      70% 10%, 
      85% 80%, 
      20% 50%, 
      50% 30%, 
      90% 70%;
  }
}

body::after {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 0;
  background: 
    linear-gradient(90deg, transparent 0%, rgba(255, 200, 0, 0.08) 50%, transparent 100%) 60% 40% / 120px 2px,
    linear-gradient(0deg, transparent 0%, rgba(0, 200, 255, 0.1) 50%, transparent 100%) 40% 90% / 2px 140px,
    linear-gradient(90deg, transparent 0%, rgba(255, 0, 150, 0.09) 50%, transparent 100%) 25% 15% / 140px 2px,
    linear-gradient(0deg, transparent 0%, rgba(200, 100, 255, 0.08) 50%, transparent 100%) 75% 25% / 2px 160px;
  background-repeat: no-repeat;
  animation: neonMove2 25s infinite linear reverse;
}

@keyframes neonMove2 {
  0% { 
    background-position: 
      60% 40%, 
      40% 90%, 
      25% 15%, 
      75% 25%;
  }
  33% { 
    background-position: 
      65% 45%, 
      45% 85%, 
      30% 20%, 
      70% 30%;
  }
  66% { 
    background-position: 
      55% 35%, 
      35% 95%, 
      20% 10%, 
      80% 20%;
  }
  100% { 
    background-position: 
      60% 40%, 
      40% 90%, 
      25% 15%, 
      75% 25%;
  }
}

@media(max-width: 600px) {
  body {
    padding: 5px;
  }
}

/* ===== ВЕРХНЯЯ ПАНЕЛЬ ===== */
.top-bar {
  position: fixed;
  top: 8px;
  left: 50%;
  transform: translateX(-50%);
  width: calc(100% - 10px);
  max-width: 1300px;
  height: 50px;
  background: var(--accent);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 12px;
  box-shadow: 0 2px 15px rgba(0, 0, 0, 0.3);
  z-index: 200;
  backdrop-filter: blur(10px);
  border-radius: 10px;
}

.back-btn {
  width: 40px;
  height: 40px;
  background: rgba(255,255,255,0.1);
  border: none;
  border-radius: 50%;
  color: white;
  font-size: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  -webkit-tap-highlight-color: transparent;
}

.back-btn:hover {
  background: rgba(255,255,255,0.2);
  transform: scale(1.1);
}

.back-btn:active {
  transform: scale(0.95);
}

.series-title {
  font-size: 14px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  text-align: center;
  flex: 1;
  padding: 0 10px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  hyphens: none; -webkit-hyphens: none; -ms-hyphens: none; word-break: keep-all; overflow-wrap: anywhere;
}

/* ===== ВИДЕО ПЛЕЕР ===== */
.video-container {
  margin-top: 65px;
  width: 100%;
  max-width: 1300px;
  margin-left: auto;
  margin-right: auto;
  position: relative;
  padding: 0 5px;
  z-index: 10;
}

@media(max-width: 600px) {
  .video-container {
    margin-top: 55px;
    padding: 0;
  }
}

.video-wrapper {
  position: relative;
  width: 100%;
  padding-bottom: 56.25%; /* 16:9 aspect ratio */
  background: #000;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 20px rgba(0,0,0,0.5);
}

.video-wrapper video {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: contain;
}

/* ===== КОНТРОЛЫ ===== */
.controls-panel {
  margin-top: 15px;
  background: var(--accent);
  border-radius: 12px;
  padding: 15px;
  backdrop-filter: blur(10px);
  position: relative;
  z-index: 10;
}

.controls-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  flex-wrap: wrap;
}

.control-group {
  display: flex;
  align-items: center;
  gap: 8px;
  background: rgba(0,0,0,0.3);
  padding: 10px 12px;
  border-radius: 10px;
  flex: 1;
  min-width: 140px;
  justify-content: center;
}

.control-label {
  font-size: 13px;
  font-weight: 600;
  color: rgba(255,255,255,0.8);
  white-space: nowrap;
}

.counter-display {
  font-size: 16px;
  font-weight: 700;
  color: #fff;
  min-width: 60px;
  text-align: center;
}

.nav-btn {
  width: 38px;
  height: 38px;
  background: rgba(255,255,255,0.15);
  border: none;
  border-radius: 50%;
  color: white;
  font-size: 18px;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}

.nav-btn:hover {
  background: rgba(255,255,255,0.3);
  transform: scale(1.1);
}

.nav-btn:active {
  transform: scale(0.95);
  background: rgba(255,255,255,0.25);
}

.nav-btn:disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

.nav-btn:disabled:hover {
  transform: scale(1);
}

.nav-btn:disabled:active {
  transform: scale(1);
}

.season-selector, .episode-selector {
  display: flex;
  align-items: center;
  gap: 10px;
}

.select-btn {
  padding: 10px 20px;
  background: rgba(255,255,255,0.1);
  border: 2px solid rgba(255,255,255,0.2);
  border-radius: 8px;
  color: white;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.select-btn:hover {
  background: rgba(255,255,255,0.2);
  border-color: rgba(255,255,255,0.4);
}

.select-btn.active {
  background: rgba(255,140,0,0.3);
  border-color: rgba(255,140,0,0.6);
}

.error-message {
  text-align: center;
  color: #ff6b6b;
  font-size: 14px;
  margin-top: 15px;
  padding: 12px;
  background: rgba(255,107,107,0.1);
  border-radius: 8px;
}

.loading {
  text-align: center;
  color: rgba(255,255,255,0.7);
  font-size: 14px;
  margin-top: 15px;
  padding: 12px;
}

@media(max-width: 600px) {
  .top-bar {
    height: 45px;
    padding: 0 8px;
    top: 5px;
    border-radius: 8px;
  }
  
  .back-btn {
    width: 36px;
    height: 36px;
    font-size: 18px;
  }
  
  .series-title {
    font-size: 12px;
    letter-spacing: 0.5px;
    padding: 0 5px;
  }
  
  .video-wrapper {
    border-radius: 8px;
  }
  
  .controls-panel {
    margin-top: 10px;
    padding: 12px;
    border-radius: 10px;
  }
  
  .controls-row {
    flex-direction: column;
    gap: 10px;
  }
  
  .control-group {
    width: 100%;
    min-width: unset;
    padding: 10px;
    gap: 6px;
    justify-content: space-between;
  }
  
  .control-label {
    font-size: 12px;
  }
  
  .counter-display {
    font-size: 14px;
    min-width: 50px;
  }
  
  .nav-btn {
    width: 36px;
    height: 36px;
    font-size: 16px;
  }
  
  .error-message,
  .loading {
    font-size: 12px;
    padding: 10px;
    margin-top: 10px;
  }
}

@media(max-width: 400px) {
  .top-bar {
    height: 42px;
  }
  
  .back-btn {
    width: 32px;
    height: 32px;
    font-size: 16px;
  }
  
  .series-title {
    font-size: 11px;
  }
  
  .video-container {
    margin-top: 50px;
  }
  
  .control-group {
    padding: 8px;
  }
  
  .nav-btn {
    width: 32px;
    height: 32px;
    font-size: 14px;
  }
}

/* ===== ОТКЛЮЧЕНИЕ НЕОНОВЫХ ПОЛОС ===== */
body::before, body::after { content: none !important; background: none !important; animation: none !important; }

/* ===== ДВУХКОЛОНОЧНЫЙ ЛЕЙАУТ ===== */
.layout {
  margin-top: 65px;
  width: 100%;
  max-width: 1300px;
  margin-left: auto;
  margin-right: auto;
  display: flex;
  gap: 16px;
  align-items: flex-start;
  padding: 0 5px;
  z-index: 10;
}

.main-col {
  flex: 1 1 auto;
  min-width: 0;
}

.side-col {
  flex: 0 0 340px;
  max-width: 340px;
}

.side-card {
  background: var(--accent);
  border-radius: 12px;
  padding: 12px;
  backdrop-filter: blur(10px);
  box-shadow: 0 4px 20px rgba(0,0,0,0.35);
}

.poster {
  width: 100%;
  aspect-ratio: 2/3;
  border-radius: 10px;
  object-fit: cover;
  display: block;
  background: #0e0e0e;
}

.wiki-title {
  font-size: 16px;
  font-weight: 800;
  margin: 10px 0 6px;
  letter-spacing: .5px;
  text-transform: uppercase;
}

.wiki-text {
  font-size: 14px;
  line-height: 1.4;
  color: rgba(255,255,255,0.85);
  white-space: pre-line;
}

.wiki-link {
  display: inline-block;
  margin-top: 8px;
  font-size: 13px;
  color: #80d8ff;
  text-decoration: none;
}

.wiki-link:hover { text-decoration: underline; }

/* ===== НИЖНЯЯ ПОЛОСА С TELEGRAM ===== */
.bottom-bar{
  width:100%;
  margin:22px 0 0;
  padding:14px 0;
  background: rgba(255,255,255,0.08);
  border-top: 1px solid rgba(255,255,255,0.08);
  border-bottom: 1px solid rgba(255,255,255,0.08);
  display:flex;
  justify-content:center;
  position: relative;
  z-index: 10;
}
.bottom-btn{
  display:inline-flex;align-items:center;justify-content:center;
  width:64px;height:64px;border-radius:999px;border:none;
  background: rgba(48,164,255,0.28); color:#bfe2ff; text-decoration:none;
}
.bottom-btn img{width:100%;height:100%;display:block;object-fit:contain;border-radius:999px;}

/* ===== Мобильная компоновка ===== */
@media(max-width:600px){
  .top-bar{height:50px; width:94%; left:50%; transform:translateX(-50%); padding:0 10px;}
  .back-btn{width:36px; height:36px; font-size:18px;}
  .series-title{font-size:12px;}
  .layout{margin-top:58px; flex-direction:column; gap:10px; padding:0 5px;}
  .main-col{width:100%;}
  .side-col{flex: 0 0 auto; max-width:100%; width:100%;}
  .video-wrapper{padding-bottom:56.25%; border-radius:10px;}
  .controls-panel{margin-top:10px; padding:12px;}
  .control-group{min-width:unset; width:100%;}
  .nav-btn{width:34px; height:34px; font-size:16px;}
  .counter-display{font-size:14px;}
  .side-card{padding:10px; display:flex; gap:10px; align-items:flex-start;}
  .poster{width:90px; flex:0 0 90px;}
  .wiki-title,.wiki-text,.wiki-link{flex:1;}
  .wiki-title{font-size:14px;}
  .wiki-text{font-size:13px;}
  .bottom-bar{padding:10px 0;}
  .bottom-btn{width:52px; height:52px;}
}
@media(max-width:480px){
  .nav-btn{width:32px; height:32px; font-size:14px;}
  .counter-display{font-size:13px;}
  .bottom-btn{width:48px; height:48px;}
}
</style>
</head>
<body>

<!-- ===== ВЕРХНЯЯ ПАНЕЛЬ ===== -->
<div class="top-bar">
  <button class="back-btn" id="backBtn" onclick="window.location.href='../index.html'">←</button>
  <div class="series-title" id="seriesTitle">Загрузка...</div>
</div>

<!-- ===== ОСНОВНОЙ ЛЕЙАУТ: СЛЕВА ПЛЕЕР, СПРАВА ИНФО ===== -->
<div class="layout">
  <div class="main-col">
    <div class="video-wrapper">
      <video id="videoPlayer" controls playsinline webkit-playsinline></video>
    </div>
    <!-- КОНТРОЛЫ ПОД ПЛЕЕРОМ -->
    <div class="controls-panel">
      <div class="controls-row">
        <div class="control-group season-selector">
          <div class="control-label">Сезон:</div>
          <button class="nav-btn" id="prevSeasonBtn">◄</button>
          <div class="counter-display" id="seasonCounter">1/1</div>
          <button class="nav-btn" id="nextSeasonBtn">►</button>
        </div>
        
        <div class="control-group episode-selector">
          <div class="control-label">Серия:</div>
          <button class="nav-btn" id="prevEpisodeBtn">◄</button>
          <div class="counter-display" id="episodeCounter">1/1</div>
          <button class="nav-btn" id="nextEpisodeBtn">►</button>
        </div>
      </div>
    </div>
  </div>
  <div class="side-col">
    <div class="side-card">
      <img id="posterImage" class="poster" alt="Постер" />
      <div class="wiki-title" id="wikiTitle">Загрузка…</div>
      <div class="wiki-text" id="wikiText">Получаем описание из Википедии…</div>
      <a id="wikiLink" class="wiki-link" href="#" target="_blank" rel="noopener noreferrer" style="display:none;">Открыть в Википедии</a>
    </div>
  </div>
</div>

<div class="error-message" id="errorMessage" style="display:none;"></div>
<div class="loading" id="loadingMessage" style="display:none;">Загрузка...</div>

<script>
// ===== КОНФИГУРАЦИЯ =====
const titles = [
  "СОПРАНО","ГОЛЯК","ИГРА ПРЕСТОЛОВ","МОЛОКОСОСЫ","БЕССТЫЖИЕ",
  "ЗАДОРНЫЕ РЕБЯТА","ВРЕМЯ ПРИКЛЮЧЕНИЙ","БИВИС И БАТХЕД","ДАРЬЯ",
  "ДОМ ДРАКОНА","ОДНАЖДЫ В ГОЛЛИВУДЕ","МАЛЬШНИК В ЛАС ВЕГАСЕ",
  "АМЕРИКАНСКАЯ ИСТОРИЯ УЖАСОВ","ХОДЯЧИЕ МЕРТВЕЦЫ","ДЕКСТЕР",
  "ОХОТА","АМЕЛИ","ВОЛК С УОЛ СТРИТ","ОСТАРЫЕ КОЗЫРЬКИ","ГНЕВ"
];

// Короткие варианты названий для отображения
const displayNames = {
  "АМЕРИКАНСКАЯ ИСТОРИЯ УЖАСОВ": "История ужасов",
  "МАЛЬШНИК В ЛАС ВЕГАСЕ": "Мальчишник: Вегас",
  "ВОЛК С УОЛ СТРИТ": "Волк с Уолл‑стрит",
  "ОСТАРЫЕ КОЗЫРЬКИ": "Козырьки",
};

// Кастомные описания (10 строк на тайтл)
const descriptions = {
  "СОПРАНО": `— История мафиозного босса Тони, балансирующего между семьёй и бизнесом.
— Терапия, панические атаки и поиск контроля над жизнью.
— Войны кланов и тяжесть наследия.
— Горький юмор и бытовая драма.
— Разговоры на кухне — как на исповеди.
— Предательство и верность меняются местами.
— Кризис среднего возраста под выстрелы.
— Власть как бремя и соблазн.
— Насилие без романтики, люди без масок.
— Телевизионная классика эпохи.`,
  "ГОЛЯК": `— Маленький прибрежный город и большие неприятности.
— Упрямый герой выживает на авось и смекалке.
— Дружба, аферы и неизбежные долги.
— Юмор на грани и трезвая ирония.
— Ошибки прошлого лезут из всех углов.
— Небогатые мечты и дорогие последствия.
— Случайные победы и частые падения.
— Любовь — как редкая передышка.
— Паб, порт и бесконечный ветер.
— Приземлённая, живая хроника края.`,
  "ИГРА ПРЕСТОЛОВ": `— Континенты, дома и железный трон.
— Политика как искусство выживания.
— Зима близко — и с ней древний страх.
— Драконы и кровь как валюта мира.
— Честь против интриги — счёт неравный.
— Герои умирают, легенды рождаются.
— Пламя амбиций и лед безжалостности.
— Клятвы, нарушенные ценой корон.
— Война — шепотом и мечом.
— Эпос, где цена — целые королевства.`,
  "МОЛОКОСОСЫ": `— Подростки на кромке взросления.
— Любовь, зависимость и поиски себя.
— Школа — фон для настоящих бурь.
— Дружбы рушатся, новые крепнут.
— Семьи трещат, правда режет.
— Музыка ночей и утренние сожаления.
— Ошибки становятся уроками — не сразу.
— Честно, неровно, болезненно красиво.
— Каждый герой — своя трагикомедия.
— Моменты, что остаются навсегда.`,
  "БЕССТЫЖИЕ": `— Семья на обочине, но вместе.
— Хаос, бедность и стальная любовь.
— Взрослеть приходится раньше срока.
— Аферы как способ выживания.
— Смех сквозь слёзы — фирменный тон.
— Отчаяние и нежность бок о бок.
— Город давит, дом держит.
— Каждый день — новая задача-невозможно.
— Герои с дефектами и золотым сердцем.
— Бесстыдно честная сага о семье.`,
  "ЗАДОРНЫЕ РЕБЯТА": `— Команда друзей и вечные проделки.
— Смех — главный двигатель приключений.
— Простые радости двора и улицы.
— Товарищество, проверенное шалостями.
— Каждый план — чуть безумие, чуть чудо.
— Ошибки проходят без злобы.
— Мир безопасно нелеп и тёпл.
— Уроки дружбы без нравоучений.
— Радость движения и фантазии.
— Детство, которое не заканчивается.`,
  "ВРЕМЯ ПРИКЛЮЧЕНИЙ": `— Путешествие мальчика и пса-метаморфа.
— Мир, где магия — норма, логика — игра.
— Смех, тоска и философия в одном кадре.
— Принцессы, короли и одиночество льда.
— Квесты, что лечат сердце.
— Песни как заклинания памяти.
— Детское снаружи, взрослое внутри.
— Многоцветный постапокалиптический сказ.
— Дружба сильнее проклятий.
— Удивляться — лучший талант.`,
  "БИВИС И БАТХЕД": `— Двое лоботрясов против скуки мира.
— Телевидение, гитары и бесконечные шутки.
— Абсурд как метод познания.
— Юмор ниже пояса — да, намеренно.
— Сатира на культуру и её фантомы.
— Простодушие превращает беды в фарс.
— Плохие идеи с большим энтузиазмом.
— Громкий смех — главный саундтрек.
— Карикатура на подростковую свободу.
— Культовый хаос 90-х.`,
  "ДАРЬЯ": `— Циничная отличница в мире конформизма.
— Сарказм как броня и компас.
— Школа как миниатюра общества.
— Семья, где никто не слышит конца фразы.
— Подруга — остров нормальности.
— Шум мира — фон для ясных мыслей.
— Никаких розовых очков, только честность.
— Юмор сухой, попадание меткое.
— Печально-смешная взрослая сказка.
— Ум — лучший бунт.`,
  "ДОМ ДРАКОНА": `— Предыстория тронной битвы и драконьей крови.
— Дом Таргариенов куется огнём.
— Род против рода — внутри одной семьи.
— Политика инкубируется в яйцах драконов.
— Наследие тяжелей короны.
— Предсказуемая трагедия — и всё равно больно.
— Пламя, что пожирает своих.
— Пиры, клятвы и ядовитые улыбки.
— Шаги к разломам эпохи.
— Хроника пепла и амбиций.`,
  "ОДНАЖДЫ В ГОЛЛИВУДЕ": `— Актёр и дублёр на изломе карьеры.
— Голливуд 60-х — миф и реальность.
— Тёплая ностальгия и киноязык игры.
— Дружба как главный жанр.
— История, что могла быть иначе.
— Влюблённый взгляд на ремесло.
— Саундтрек, солнце и легкая грусть.
— Комедия жестов и деталей.
— Кинематограф о себе самом.
— Письмо времени на плёнке.`,
  "МАЛЬШНИК В ЛАС ВЕГАСЕ": `— Вчерашние приличные — сегодняшние легенды.
— Память пропала, приключения остались.
— Вегас как машина случайностей.
— Дружба проверяется абсурдом.
— Поиски улик в море неонового хаоса.
— Каждая находка смешнее предыдущей.
— Проблемы множатся быстрее планов.
— Утро приносит ответы и новые вопросы.
— Буйная одиссея одного вечера.
— Комедия, которую нельзя повторить.`,
  "АМЕРИКАНСКАЯ ИСТОРИЯ УЖАСОВ": `— Антология страхов — каждый сезон свой кошмар.
— Дом с призраками, цирк уродов, ведьмы, отель.
— Красота кадра и ужас сюжета.
— Грехи прошлого возвращаются с процентами.
— Маски срастаются с лицом.
— Шоу о чудовищах в нас самих.
— Любовь как тёмный ритуал.
— Смелые жанровые эксперименты.
— Саунд-дизайн, что лезет под кожу.
— Кошмар, от которого не отвести глаз.`,
  "ХОДЯЧИЕ МЕРТВЕЦЫ": `— Мир после — и люди в нём.
— Зомби — декорация для нравственного выбора.
— Семьи собираются из чужих.
— Лагеря, фермы, тюрьмы, дороги.
— Цена человечности каждый день.
— Вождь — это ответственность за боль.
— Каждый сезон — новый кодекс выживания.
— Надежда упрямее смерти.
— Дружба как броня.
— Драма длиннее апокалипсиса.`,
  "ДЕКСТЕР": `— Судмедэксперт с кодексом в тени.
— Монстр, который охотится на монстров.
— Двойная жизнь как искусство маскировки.
— Холодный анализ и горячая кровь.
— Семья — якорь и угроза.
— Вина, которую не стереть.
— Погоня за собой — самая страшная.
— Этика, собранная по частям.
— Голос за кадром — голос совести.
— Триллер с анатомией души.`,
  "ОХОТА": `— Провинция, подозрение и один неверный шаг.
— Община ищет виновного, не истину.
— Дружба трескается от страха.
— Слова превращаются в камни.
— Тишина громче крика.
— Взгляд ребёнка и вина взрослых.
— Лицо честного человека под прицелом.
— Суд не там, где зал.
— Рана, что не заживает.
— Драма, которая щемит долго.`,
  "АМЕЛИ": `— Париж глазами мечтательницы.
— Маленькие добрые заговоры.
— Нежность к странностям людей.
— Игры со случайностью и судьбой.
— Цвета как эмоции кадра.
— Фотоавтоматы, стрелки и подсказки.
— Любовь — как загадка и игра.
— Тепло, что лечит одиночество.
— Поэзия повседневности.
— Сказка, в которую веришь.`,
  "ВОЛК С УОЛ СТРИТ": `— Биржевой рай, где мораль — расходник.
— Вкус денег и скорость падения.
— Карьера на адреналине и лжи.
— Комизм в сопровождении цинизма.
— Вечеринка, которая не кончится сама.
— Команда, верная пороку.
— Падение как шоу.
— Хищник в костюме и без него.
— Хроника без тормозов.
— Веселье, которое дорого обойдётся.`,
  "ОСТАРЫЕ КОЗЫРЬКИ": `— Гангстеры Бирмингема после войны.
— Бритвы в козырьках и планы на века.
— Томас Шелби — холодная голова, горячее сердце.
— Бизнес, политика и семейные узы.
— Любовь и месть переплетены прочно.
— Стиль как оружие.
— Враги растут вместе с амбициями.
— Музыка бьёт как молот.
— Дым фабрик и порох в воздухе.
— Легенда, выкованная огнём.`,
  "ГНЕВ": `— Мужчина, у которого отняли покой.
— Месть — метод и смысл.
— Тишина перед бурей — его язык.
— Преступный мир под прицелом.
— Холодная стратегия и горячая расплата.
— Пули как аргументы судьбы.
— Тайна, которую он несёт один.
— Правосудие без присяжных.
— Город как поле боя.
— Жёсткий, прямой, без скидок.`,
};

// Получаем индекс из URL
function getPlayerIndex() {
  try {
    // Пробуем получить из параметра URL
    const urlParams = new URLSearchParams(window.location.search);
    const index = urlParams.get('index');
    if (index) {
      const idx = parseInt(index) - 1;
      if (idx >= 0 && idx < titles.length) return idx;
    }
    
    // Если нет параметра, пытаемся получить из имени файла
    const path = window.location.pathname || window.location.href;
    const match = path.match(/player[_\s]?(\d+)\.html/i);
    if (match) {
      const idx = parseInt(match[1]) - 1;
      if (idx >= 0 && idx < titles.length) return idx;
    }
    
    // Пробуем получить из hash
    const hash = window.location.hash;
    if (hash) {
      const hashMatch = hash.match(/[#&]index=(\d+)/);
      if (hashMatch) {
        const idx = parseInt(hashMatch[1]) - 1;
        if (idx >= 0 && idx < titles.length) return idx;
      }
    }
  } catch (e) {
    console.error('Ошибка получения индекса:', e);
  }
  
  return 0;
}

// Получаем название сериала
function getSeriesName() {
  const index = getPlayerIndex();
  return titles[index] || titles[0];
}

// ===== СОСТОЯНИЕ ПЛЕЕРА =====
let currentSeason = 1;
let currentEpisode = 1;
let maxSeasons = 10; // Максимальное количество сезонов (можно определить динамически)
let maxEpisodes = {}; // Объект для хранения количества серий в каждом сезоне

// Переменные для элементов DOM (будут инициализированы позже)
let videoPlayer, seriesTitle, seasonCounter, episodeCounter;
let prevSeasonBtn, nextSeasonBtn, prevEpisodeBtn, nextEpisodeBtn;
let errorMessage, loadingMessage;
let seriesName;

// ===== ФУНКЦИИ ЗАГРУЗКИ ВИДЕО =====
function getVideoPath(season, episode) {
  const seriesPath = encodeURIComponent(seriesName);
  // Поддерживаем разные форматы: .mp4, .mkv, .webm и т.д.
  // Пробуем разные варианты имен файлов
  const possibleNames = [
    `${episode}.mp4`,
    `${episode}.mkv`,
    `${episode}.webm`,
    `episode_${episode}.mp4`,
    `episode_${episode}.mkv`,
    `s${season}e${episode}.mp4`,
    `s${season}e${episode}.mkv`,
    `S${String(season).padStart(2, '0')}E${String(episode).padStart(2, '0')}.mp4`,
    `S${String(season).padStart(2, '0')}E${String(episode).padStart(2, '0')}.mkv`
  ];
  
  // Возвращаем первый вариант (можно расширить логику проверки)
  return `../plans/${seriesPath}/${season}/${episode}.mp4`;
}

function loadVideo(season, episode) {
  if (!videoPlayer) {
    console.error('Видео плеер не найден');
    return;
  }
  
  loadingMessage.style.display = 'block';
  errorMessage.style.display = 'none';
  
  // Очищаем предыдущие обработчики
  videoPlayer.onloadeddata = null;
  videoPlayer.onerror = null;
  videoPlayer.oncanplay = null;
  
  const videoPath = getVideoPath(season, episode);
  console.log('Загрузка видео:', videoPath);
  
  // Устанавливаем источник
  videoPlayer.src = videoPath;
  videoPlayer.load(); // Принудительная загрузка для мобильных
  
  videoPlayer.oncanplay = () => {
    loadingMessage.style.display = 'none';
    errorMessage.style.display = 'none';
    console.log('Видео готово к воспроизведению');
  };
  
  videoPlayer.onloadeddata = () => {
    loadingMessage.style.display = 'none';
    errorMessage.style.display = 'none';
    videoPlayer.play().catch(e => {
      console.log('Автовоспроизведение заблокировано:', e);
    });
  };
  
  videoPlayer.onerror = (e) => {
    console.error('Ошибка загрузки видео:', e, videoPath);
    loadingMessage.style.display = 'none';
    errorMessage.style.display = 'block';
    errorMessage.textContent = `Видео не найдено: Сезон ${season}, Серия ${episode}`;
    
    // Пробуем другие форматы
    tryAlternativeFormats(season, episode);
  };
}

function tryAlternativeFormats(season, episode) {
  const seriesPath = encodeURIComponent(seriesName);
  const formats = ['mp4', 'mkv', 'webm'];
  const names = [
    `${episode}`,
    `episode_${episode}`,
    `s${season}e${episode}`,
    `S${String(season).padStart(2, '0')}E${String(episode).padStart(2, '0')}`
  ];
  
  let tried = 0;
  const total = formats.length * names.length;
  
  function tryNext() {
    if (tried >= total) return;
    
    const formatIndex = Math.floor(tried / names.length);
    const nameIndex = tried % names.length;
    const path = `../plans/${seriesPath}/${season}/${names[nameIndex]}.${formats[formatIndex]}`;
    
    tried++;
    
    fetch(path, { method: 'HEAD' })
      .then(response => {
        if (response.ok) {
          videoPlayer.src = path;
          loadingMessage.style.display = 'none';
          errorMessage.style.display = 'none';
        } else {
          tryNext();
        }
      })
      .catch(() => {
        tryNext();
      });
  }
  
  tryNext();
}

// ===== ОБНОВЛЕНИЕ СЧЕТЧИКОВ =====
function updateCounters() {
  const maxEp = maxEpisodes[currentSeason] || 10;
  
  if (seasonCounter) {
    seasonCounter.textContent = `${currentSeason}/${maxSeasons}`;
  }
  
  if (episodeCounter) {
    episodeCounter.textContent = `${currentEpisode}/${maxEp}`;
  }
  
  // Обновляем состояние кнопок
  if (prevSeasonBtn) {
    prevSeasonBtn.disabled = currentSeason <= 1;
  }
  
  if (nextSeasonBtn) {
    nextSeasonBtn.disabled = currentSeason >= maxSeasons;
  }
  
  if (prevEpisodeBtn) {
    prevEpisodeBtn.disabled = currentEpisode <= 1;
  }
  
  if (nextEpisodeBtn) {
    nextEpisodeBtn.disabled = currentEpisode >= maxEp;
  }
}

// ===== НАВИГАЦИЯ =====
function changeSeason(direction) {
  const newSeason = currentSeason + direction;
  if (newSeason < 1 || newSeason > maxSeasons) {
    console.log(`Невозможно перейти к сезону ${newSeason}. Текущий диапазон: 1-${maxSeasons}`);
    return;
  }
  
  currentSeason = newSeason;
  currentEpisode = 1; // Сбрасываем на первую серию при смене сезона
  updateCounters();
  loadVideo(currentSeason, currentEpisode);
  saveProgress();
}

function changeEpisode(direction) {
  const maxEp = maxEpisodes[currentSeason] || 10;
  const newEpisode = currentEpisode + direction;
  if (newEpisode < 1 || newEpisode > maxEp) {
    console.log(`Невозможно перейти к серии ${newEpisode}. Текущий диапазон: 1-${maxEp}`);
    return;
  }
  
  currentEpisode = newEpisode;
  updateCounters();
  loadVideo(currentSeason, currentEpisode);
  saveProgress();
}

// ===== ОБРАБОТЧИКИ СОБЫТИЙ =====
// (Обработчики будут добавлены в функции initPlayer)

// Загружаем сохраненный прогресс из localStorage
function loadProgress() {
  const key = `player_${seriesName}_progress`;
  const saved = localStorage.getItem(key);
  if (saved) {
    try {
      const progress = JSON.parse(saved);
      currentSeason = progress.season || 1;
      currentEpisode = progress.episode || 1;
    } catch (e) {
      console.error('Ошибка загрузки прогресса:', e);
    }
  }
}

// Сохраняем прогресс
function saveProgress() {
  const key = `player_${seriesName}_progress`;
  localStorage.setItem(key, JSON.stringify({
    season: currentSeason,
    episode: currentEpisode
  }));
}

// (Обработчик будет добавлен в функции initPlayer)

// Пытаемся определить количество серий в каждом сезоне
function detectMaxEpisodes() {
  // Инициализируем значения по умолчанию
  for (let s = 1; s <= maxSeasons; s++) {
    maxEpisodes[s] = 10; // По умолчанию 10 серий в сезоне
  }
  updateCounters();
}

// ===== ИНИЦИАЛИЗАЦИЯ =====
// Ждем полной загрузки DOM
function initPlayer() {
  try {
    // Инициализируем элементы DOM
    videoPlayer = document.getElementById('videoPlayer');
    seriesTitle = document.getElementById('seriesTitle');
    seasonCounter = document.getElementById('seasonCounter');
    episodeCounter = document.getElementById('episodeCounter');
    prevSeasonBtn = document.getElementById('prevSeasonBtn');
    nextSeasonBtn = document.getElementById('nextSeasonBtn');
    prevEpisodeBtn = document.getElementById('prevEpisodeBtn');
    nextEpisodeBtn = document.getElementById('nextEpisodeBtn');
    errorMessage = document.getElementById('errorMessage');
    loadingMessage = document.getElementById('loadingMessage');
    
    // Получаем название сериала
    seriesName = getSeriesName();
    
    console.log('Инициализация плеера...');
    console.log('Название сериала:', seriesName);
    console.log('Индекс:', getPlayerIndex());
    
    // Проверяем наличие всех элементов
    if (!videoPlayer) {
      console.error('Видео плеер не найден');
      if (errorMessage) {
        errorMessage.style.display = 'block';
        errorMessage.textContent = 'Ошибка: Видео плеер не найден';
      }
      return;
    }
    
    if (!seriesTitle) {
      console.error('Элемент названия не найден');
      return;
    }
    
    // Устанавливаем название сериала
    seriesTitle.textContent = seriesName;
    
    // Инициализируем обработчики событий
    if (prevSeasonBtn) {
      prevSeasonBtn.addEventListener('click', (e) => {
        e.preventDefault();
        changeSeason(-1);
      });
    }
    
    if (nextSeasonBtn) {
      nextSeasonBtn.addEventListener('click', (e) => {
        e.preventDefault();
        changeSeason(1);
      });
    }
    
    if (prevEpisodeBtn) {
      prevEpisodeBtn.addEventListener('click', (e) => {
        e.preventDefault();
        changeEpisode(-1);
      });
    }
    
    if (nextEpisodeBtn) {
      nextEpisodeBtn.addEventListener('click', (e) => {
        e.preventDefault();
        changeEpisode(1);
      });
    }
    
    // Сохраняем прогресс при воспроизведении
    videoPlayer.addEventListener('play', saveProgress);
    
    // Инициализируем значения перед загрузкой
    detectMaxEpisodes();
    loadProgress();
    updateCounters();
    loadVideo(currentSeason, currentEpisode);
  } catch (e) {
    console.error('Ошибка инициализации:', e);
    if (errorMessage) {
      errorMessage.style.display = 'block';
      errorMessage.textContent = 'Ошибка инициализации плеера: ' + e.message;
    }
  }
}

// ===== САЙДБАР: ПОСТЕР + ОПИСАНИЕ =====
function initSidebar() {
  try {
    const poster = document.getElementById('posterImage');
    const titleEl = document.getElementById('wikiTitle');
    const textEl = document.getElementById('wikiText');
    const linkEl = document.getElementById('wikiLink');
    const idx = getPlayerIndex();
    const displayIndex = idx + 1;
    const name = getSeriesName();
    const displayName = displayNames[name] || name;

    // Аватар (постер) берем из плашек на главной: img/top/{index}.png
    if (poster) {
      poster.src = `../img/top/${displayIndex}.png`;
      poster.alt = displayName;
    }

    // Заголовок и кастомное описание на 10 строк
    if (titleEl) titleEl.textContent = displayName;
    if (textEl) {
      textEl.textContent = descriptions[name] || 'Описание скоро будет обновлено.';
      textEl.style.whiteSpace = 'pre-line';
    }
    if (linkEl) linkEl.style.display = 'none';
  } catch (e) {
    console.error('Ошибка сайдбара:', e);
  }
}

// Запускаем инициализацию после загрузки DOM
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => { initPlayer(); initSidebar(); });
} else {
  // DOM уже загружен
  initPlayer();
  initSidebar();
}
</script>

<!-- Нижняя широкая полоса с Telegram -->
<div class="bottom-bar">
  <a class="bottom-btn" href="https://t.me/DAWRT223" target="_blank" rel="noopener noreferrer">
    <img src="../icons/telegram.png" alt="Telegram" />
  </a>
</div>

</body>
</html>
